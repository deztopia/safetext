<div data-role="page" class="safetext-page safetext-conversation" data-title="<?php echo $this->t('Conversation'); ?> - <?php echo $this->getValue('contactName'); ?>">
		
		<div data-role="panel" class="leftpanel" data-position="left" data-display="reveal" data-theme="b"></div>
		<?php echo $this->render('webclient/_header_conversation.phtml'); ?>
	
	    <div data-role="content" class="safetext-content" data-theme="a">
	    	
		    <div class="safetext-client-grid">
		    	<!-- Left-hand Folder Column -->
			    <div class="safetext-block-a">
			    	<div class="ui-body ui-body-d">
					    <?php echo $this->render('webclient/_foldermenu.phtml'); ?>
					</div>
			    </div>
			    
			    <!-- Main Content Column -->
			    <div class="safetext-block-b">
			    	<div class="ui-body ui-body-d">
				    	<div class="ui-grid-b safetext-mobile-hidden">
						    <div class="ui-block-a"><a href="/webclient/messages" class="ui-shadow ui-btn ui-corner-all ui-btn-icon-left ui-icon-mail ui-btn-active">Messages</a></div>
						    <div class="ui-block-b"><a href="/webclient/contacts" class="ui-btn ui-corner-all ui-btn-icon-left ui-icon-user">Contacts</a></div>
						    <div class="ui-block-c"><a href="/settings" class="ui-btn ui-corner-all ui-btn-icon-left ui-icon-gear">Settings</a></div>
						</div>
						
						<div class="safetext-mobile-hidden">
							<h3><?php echo $this->getValue('contactName'); ?></h3>
						</div>
						
						<div class="safetext-chat-container">
								<?php $lastHrsElapsed = ''; ?>
						    	<?php foreach ($this->getValue('conversation') as $this_message) : 
							    	// get time since it's been sent
							    	$secsElapsed = time() - strtotime($this_message->sent_date);
							    	$minsElapsed = round($secsElapsed /60, 0, PHP_ROUND_HALF_DOWN);
							    	$hrsElapsed = round($minsElapsed /60, 0, PHP_ROUND_HALF_DOWN);
							    	if ($hrsElapsed < 1) {
							    		$timeElapsed = $minsElapsed . ' ' . $this->t('min');
							    		if ($minsElapsed > 1 || $minsElapsed === 0) $timeElapsed .= 's';
							    	} else {
							    		$timeElapsed = $hrsElapsed . ' ' . $this->t('hr');
							    		if ($hrsElapsed > 1) $timeElapsed .= 's';
							    	}
							    	
							    	// get time to expire
							    	$secsLeft = strtotime($this_message->expire_date) - time();
							    	if ($secsLeft < 0) $secsLeft = 0;
							    	$minsLeft = round($secsLeft /60, 0, PHP_ROUND_HALF_DOWN);
							    	$hrsLeft = round($minsLeft /60, 0, PHP_ROUND_HALF_DOWN);
							    	
							    	if ($hrsLeft < 1) {
							    		$timeLeft = $minsLeft . ' ' . $this->t('min');
							    		if ($minsLeft > 1 || $minsLeft === 0) $timeLeft .= 's';
							    	} else {
							    		$timeLeft = $hrsLeft . ' ' . $this->t('hr');
							    		if ($hrsLeft > 1) $timeLeft .= 's';
							    	}
						    	?>
					    		<div class="<?php if ($this_message->sender === $this->getValue('user')->id) echo 'bubble bubble--alt'; else echo 'bubble'; ?>" data-id="<?php echo $this_message->id; ?>">
					    			<?php echo $this_message->content; ?>
					    			<?php if ($this_message->image_name != ''): ?>
					    				<div class="safetext-image-container">
					    					<img src="/assets/images/users/<?php echo $this_message->image_name; ?>-s.jpg" />
					    				</div>
					    			<?php endif; ?>
					    			<a href="index.html" class="safetext-delete-bubble-icon ui-btn ui-shadow ui-corner-all ui-icon-delete ui-btn-icon-notext">Delete</a>
					    		</div>
					    		<div class="safetext-timedetails-<?php if ($this_message->sender === $this->getValue('user')->id) echo 'right'; else echo 'left'; ?>">
					    			<?php if ($lastHrsElapsed === '' || ($lastHrsElapsed - $hrsElapsed) > 1) : // only post time details if significant difference ?>
						    			<?php echo $this->t('sent'); ?> <?php echo $timeElapsed; ?> <?php echo $this->t('ago'); ?>,
						    			<?php echo $this->t('deletes in'); ?> <?php echo $timeLeft; ?>
					    			<?php endif; ?>
					    			<?php $lastHrsElapsed = $hrsElapsed; ?>
					    		</div>
						    	<?php endforeach; ?>
						</div>
						
						<span class="kit-new-message-content" style="display:none;">
							<div class="bubble bubble--alt"></div>
							<div class="safetext-timedetails-right"></div>
						</span>
						    
			    	</div>
			    </div>

			</div>
	    
	    </div><!-- /content -->
	    
	    <!-- delete message popup -->
		<div class="safetext-confirm-delete-popup" data-role="popup" data-overlay-theme="b" data-theme="b" data-dismissible="false" style="max-width:400px;">
	    	<a href="#" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right">Close</a>
	        <div data-role="header" data-theme="a">
	            <h1><?php echo $this->t('Delete Message'); ?>?</h1>
	        </div>
	        <div role="main" class="ui-content">
	            <h3 class="ui-title"><?php echo $this->t('Confirm delete'); ?></h3>
	            <p><?php echo $this->t('This message will be permanently deleted for all participants'); ?>. <?php echo $this->t('This action is not reversible'); ?>.</p>
	            <fieldset class="ui-grid-a">
		            <div class="ui-block-a"><a href="#" class="ui-btn ui-corner-all ui-shadow ui-btn-b" data-rel="back">Cancel</a></div>
		            <div class="ui-block-b"><a href="#" class="ui-btn ui-corner-all ui-shadow ui-btn-b safetext-confirm-delete-button" 
		                data-safetext-deletemessage-id=""
						data-rel="back" data-transition="flow"><?php echo $this->t('Delete'); ?></a></div>
	            </fieldset>
	        </div>
	    </div>
    <!-- /delete message popup -->
	
	<?php echo $this->render('webclient/_compose_footer.phtml'); ?>
		
</div> <!--/page-->